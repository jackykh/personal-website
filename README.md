# Personal Website with Blog

This project is a responsive personal website built with Next.js, featuring a blog section with SSG (Static Site Generation) and ISR (Incremental Static Regeneration). The website showcases personal projects and a self-introduction on the homepage, with a blog managed through a self-hosted Strapi CMS. The site revalidates pages on content updates through a custom webhook.

## Features

- **Responsive Design**: Adapts to different screen sizes for an optimal user experience across devices.
- **Blog with SSG and ISR**: Utilizes Static Site Generation for improved performance and Incremental Static Regeneration to update stale pages.
- **GraphQL Integration**: Connects to a Strapi backend via GraphQL to retrieve data.
- **Automatic Page Revalidation**: Utilizes a custom API with a secret token to revalidate pages when content changes are detected.
- **Dynamic Sitemap**: The sitemap is dynamically generated by rewriting to Strapi based on post IDs.

## Project Structure

```plaintext
├── Components
│   ├── Footer.tsx
│   ├── PostList.tsx
│   ├── SectionFour.tsx
│   ├── SectionOne.tsx
│   ├── SectionThree.tsx
│   ├── SectionTwo.tsx
│   └── uiComponents
│       ├── ImageBox.tsx
│       ├── LoadingSpinner.tsx
│       ├── Navigation.tsx
│       ├── Pagination.tsx
│       ├── PostPreview.tsx
│       ├── ProjectDetailsEl.tsx
│       ├── SectionNav.tsx
│       └── SideModal.tsx
├── hooks
│   ├── useCloseDropdownWhenClickedOutside.tsx
│   ├── useEffectDebugger.tsx
│   ├── useEnterToFetch.tsx
│   └── useMediaQuery.tsx
├── lib
│   └── apollo-client.ts
├── pages
│   ├── 404.tsx
│   ├── 500.tsx
│   ├── _app.tsx
│   ├── _document.tsx
│   ├── api
│   │   └── revalidate.ts
│   ├── blog
│   │   ├── category/[categoryId]/page/[categoryPage].tsx
│   │   ├── page/[page].tsx
│   │   └── post/[postId].tsx
│   └── index.tsx
└── utils
    ├── getPreview.ts
    └── isNumber.ts
```

### Key Files

- **Components**: Contains modular, reusable components like navigation, pagination, and sections.
- **hooks**: Custom hooks to manage UI behaviors such as handling media queries and debugging side effects.
- **lib/apollo-client.ts**: Sets up Apollo Client for GraphQL API integration.
- **pages/api/revalidate.ts**: API route for handling page revalidation triggered by Strapi webhooks.

## Revalidation API

The `revalidate.ts` API listens for specific events from Strapi (e.g., entry updates, deletions) and selectively revalidates blog posts and paginated lists. Key parts of this API:

- **Authentication**: Requires a secret token to ensure valid requests.
- **Event Handling**: Supports `entry.update`, `entry.delete`, `entry.publish`, and `entry.unpublish`.
- **Pagination Revalidation**: Revalidates paginated pages for posts and category-specific pages based on updated post counts.

## Getting Started

### Prerequisites

- **Node.js** and **npm** installed
- A **Strapi CMS** backend with a connected GraphQL plugin.

### Installation

1. Clone the repository:

   ```bash
   git clone https://github.com/jackykh/personal-website.git
   cd personal-website
   ```

2. Install dependencies:

   ```bash
   npm install
   ```

3. Set up environment variables:

   - Create a `.env.local` file in the root directory.
   - Define your Strapi URL and secret token:
     ```plaintext
     NEXT_PUBLIC_STRAPI_URL=https://your-strapi-instance.com/graphql
     MY_SECRET_TOKEN=your-secret-token
     ```

4. Run the development server:

   ```bash
   npm run dev
   ```

   Open [http://localhost:3000](http://localhost:3000) to view the website.

### Deployment

1. Deploy to a platform that supports Next.js (e.g., Vercel).
2. Ensure the environment variables are properly set up in the deployment environment.
3. Set up a webhook in Strapi to call your deployed revalidation endpoint (`/api/revalidate`) with the secret token when content is updated.

## License

Copyright © 2022-present Jacky Cheung. All rights reserved.
